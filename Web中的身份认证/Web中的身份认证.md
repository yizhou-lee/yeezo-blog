[TOC]

# Web中的身份认证

## 身份认证

身份认证（Authentication）是指验证用户或系统的身份的过程，以确保其是其声称的身份。身份认证通常是安全系统的第一步，用于防止未经授权的访问。通俗来说，身份认证就是确认你是谁的过程。

## 认证方法

### HTTP Basic Authentication

HTTP 基本验证（HTTP Basic Authentication）是一种简单的、基于用户名和密码的用户验证机制。它常用于保护 Web 资源，需要客户端在每次请求时提供凭据来进行身份验证。

**基本工作原理**

1. **客户端请求受保护的资源**：客户端（例如浏览器）向服务器发送请求，尝试访问受保护的资源。

2. **服务器响应 401 未授权状态码**：如果该资源受到 HTTP 基本验证保护，服务器会响应 HTTP 状态码 `401 Unauthorized`，并在响应头中包含一个 `WWW-Authenticate` 头，指明客户端需要提供身份验证信息。

   ```http
   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Basic realm="Access to the site"
   ```

3. **客户端发送凭据**：客户端收到 `401` 响应后，会提示用户输入用户名和密码。然后，客户端将这些凭据通过 **Base64** 编码后放在 `Authorization` 头中，并再次向服务器发送请求。

   ```http
   GET /protected-resource HTTP/1.1
   Host: www.example.com
   Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=
   ```

   其中 `dXNlcm5hbWU6cGFzc3dvcmQ=` 是将 `username:password` 字符串进行 Base64 编码后的值。

4. **服务器验证凭据**：服务器收到请求后，会对 `Authorization` 头中的 Base64 编码进行解码，获取用户名和密码。然后，服务器验证这些凭据是否正确。

5. **成功验证**：如果凭据正确，服务器会返回受保护的资源；如果凭据不正确，则服务器继续返回 `401 Unauthorized`，要求客户端重新提供凭据。

![image-20240926151334507](./assets/basic-auth.png)

**使用场景**

- 简单的API认证
- 临时或内部资源保护

**优点**

- **实现简单**：HTTP 基本验证是 HTTP 协议的一部分，标准且简单易用，几乎不需要额外的代码或库支持。
- **无需 Cookies 或会话**：与基于 Cookie 的会话认证不同，HTTP 基本验证不依赖 Cookie 或服务器状态，所有信息都包含在请求中，适合 RESTful API 的无状态特性。

**缺点**

- **凭据暴露**：由于用户名和密码只是通过 Base64 编码，编码并不等于加密，因此凭据很容易被解码并暴露出来。如果通过不安全的 HTTP 连接传输，可能会被中间人拦截。因此，HTTP 基本验证通常需要通过 HTTPS 来确保凭据的安全传输。

### 基于会话的验证

基于会话（session）的身份认证是一种常用的用户身份验证机制，广泛应用于Web应用程序中。它的基本理念是通过创建并管理用户会话来保持用户的登录状态。

**基本工作原理**

1. **用户登录**：用户通过登录页面输入用户名和密码。服务器接收这些凭据并验证其有效性。

2. **创建会话**：如果验证成功，服务器为该用户创建一个会话。服务器生成一个唯一的会话ID（session ID），并将其与用户的身份信息（如用户ID、权限等）关联。会话ID通常会通过HTTP Cookie的形式发送给用户的浏览器。

3. **会话管理**：用户在后续请求中，浏览器会自动将会话ID包含在请求中（通过Cookie）。服务器根据会话ID查找对应的会话信息，从而识别出用户身份。

4. **用户操作**：在会话有效期内，用户可以执行各种操作，服务器根据会话信息决定用户的权限和可操作的内容。

5. **退出登录**：用户可以选择退出登录，此时服务器会销毁会话信息，并清除浏览器中的会话ID Cookie。

![image-20240926175620109](./assets/session-auth.png)

**使用场景**

- 基于会话的身份认证在需要**维护用户状态的应用场景**中具有广泛的适用性。例如用户个人信息管理、购物车管理、个人权限管理。
- **单体应用**：

**优点**

- **状态管理**：会话允许服务器在多个请求之间维护用户的状态。
- **安全性**：相比于在每个请求中都发送用户名和密码，会话ID更为安全。

**缺点**

- **服务器负担**：会话数据存储在服务器端，如果用户数量较多，可能导致服务器内存压力增大。
- **不符合REST架构的无状态原则**：基于session的身份认证是有状态的，每个请求都依赖服务器的会话数据，而REST要求每个请求都独立，不能依赖服务器的状态。
- **拓展性问题**：基于session的身份认证需要在服务器端维护会话数据。对于单服务器应用来说，这并不复杂，但对于现代分布式系统（如负载均衡、多服务器集群）来说，保持每台服务器都有一致的会话数据变得复杂且难以维护。

